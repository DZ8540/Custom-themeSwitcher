"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThemeSwitcher=void 0;class ThemeSwitcher{constructor(e,t){this.elementsClass="ThemeSwitcher__item",this.elementActiveClass=`${this.elementsClass}--active`,this.el=e,this.elements=[...e.querySelectorAll(`.${this.elementsClass}`)],this.linkEl=document.head.querySelector(`#${t.linkId}`),this.lightSchemeRoute=t.routes.light,this.darkSchemeRoute=t.routes.dark,this.schemeKey=t.schemeKey,this.defaultScheme=t.defaultScheme,this.name=e.dataset.name||"",this.init()}init(){try{this.check(),this.listen();let e=this.getScheme();this.setScheme(e),this.el.onclick=this.clickHandler.bind(this)}catch(e){console.warn(e.message)}}clickHandler(){let e=["light","dark","system"],t=this.getScheme(),s=e.findIndex(e=>e==t);e.length-1==s?s=0:s++;let i=e[s];this.setScheme(i)}listen(){window.addEventListener("storage",()=>{let e=this.getScheme();for(let e of this.elements)e.classList.remove(this.elementActiveClass);switch(this.elements.find(t=>t.dataset.value==e).classList.add(this.elementActiveClass),e){case"light":this.setLink(this.lightSchemeRoute);break;case"dark":this.setLink(this.darkSchemeRoute);break;case"system":this.systemSchemeListener()}})}systemSchemeListener(){let e=window.matchMedia("(prefers-color-scheme: light)");e.matches?this.setLink(this.lightSchemeRoute):this.setLink(this.darkSchemeRoute),e.addListener(e=>{e.matches?this.setLink(this.lightSchemeRoute):this.setLink(this.darkSchemeRoute)})}setLink(e){this.linkEl.setAttribute("href",e)}getScheme(){let e=["light","dark","system"],t=localStorage.getItem(this.schemeKey)||this.defaultScheme;return e.includes(t)&&t.length||(t=this.defaultScheme),t}setScheme(e){localStorage.setItem(this.schemeKey,e),window.dispatchEvent(new Event("storage"))}check(){if(!this.el)throw new Error(`Component "${this.name}" not found!`);if(!this.linkEl)throw new Error("Link element for change theme is not found!");console.info(`Component "${this.name}" is ready.`)}}exports.ThemeSwitcher=ThemeSwitcher,exports.default=ThemeSwitcher;